<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>퀴즈 참여 - 싱글 플레이</title>
  <link rel="stylesheet" href="/style.css">
  <style>
    .content-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }

    .quiz-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .quiz-buttons button {
      padding: 20px 40px;
      font-size: 1.5em;
      background-color: black;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 10px;
    }

    .quiz-buttons button:hover {
      background-color: grey;
      color: black;
    }

    #search-input {
      width: 60%;
      padding: 10px;
      font-size: 1.2em;
      margin-top: 10px;
    }

    #quiz-list-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      width: 80%;
      max-height: 400px;
      overflow-y: auto;
    }

    #quiz-list {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid black;
    }

    #quiz-list th, #quiz-list td {
      text-align: center;
      padding: 10px;
      border-bottom: 1px solid black;
    }

    #quiz-list thead th {
      position: sticky;
      top: 0;
      background: #f9f9f9;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 70%;
      margin-top: 20px;
      padding: 0 15%;
      font-size: 1.5em;
      justify-content: space-between; /* 내부 요소들 간의 간격을 조절 */
      gap: 20px;
    }

    .controls button, .controls input {
      padding: 10px;
      font-size: 1.2em;
      font-family: inherit;
    }

    #start-button {
      padding: 8px 50px;
      font-size: 1.2em;
      cursor: pointer;
      margin-left: auto;
    }

    #set-max-questions {
      margin-left: 20px;
      font-size: 1.2em;
    }
  </style>
</head>

<body>
  <!-- 정상화 퀴즈 제목 링크 -->
  <h1><a href="/" style="text-decoration: none; color: inherit;">정상화 퀴즈</a></h1>

  <!-- 로그인 버튼/사용자 정보 표시 영역 -->
  <div id="user-info" style="position: fixed; top: 20px; right: 20px;"></div>

  <!-- 콘텐츠 추가 -->
  <div class="content-container">
    <!-- 퀴즈 선택 영역 -->
    <div class="quiz-buttons">
      <button id="sentence-quiz-button">문장 퀴즈</button>
      <button id="image-quiz-button">그림 퀴즈</button>
      <button id="sound-quiz-button">사운드 퀴즈</button>
    </div>

    <!-- 검색 입력란 -->
    <input type="text" id="search-input" placeholder="검색...">

    <!-- 퀴즈 목록 -->
    <div id="quiz-list-container">
      <table id="quiz-list">
        <thead>
          <tr>
            <th>퀴즈 이름</th>
            <th>제작자</th>
            <th>제작일</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- 문제 수와 시작 버튼 -->
    <div class="controls">
      <div style="text-align: left;">
        <label>문제 수</label>
        <input type="number" id="num-questions" value="1" min="1" style="width: 50px; font-size: 1em;">
        / <span id="max-questions">0</span>
        <button id="set-max-questions">최대</button>
      </div>
      <button id="start-button">시작</button>
    </div>
  </div>

  <script>
    let quizzes = [];

    // 로그인 상태에 따라 로그인/로그아웃 버튼과 사용자 이름을 표시하는 JavaScript
    document.addEventListener('DOMContentLoaded', function () {
      fetch('/check-login')
        .then(response => response.json())
        .then(data => {
          const userInfo = document.getElementById('user-info');
          if (data.loggedIn) {
            userInfo.innerHTML = `
              <span style="font-size: 1.5em; font-weight: bold; margin-right: 150px; margin-top: 10px; display: inline-block;">${data.username}</span>
              <button class="login-button" onclick="location.href='/logout/'">로그아웃</button>
            `;
          } else {
            userInfo.innerHTML = `
              <button class="login-button" onclick="location.href='/login/'">로그인</button>
            `;
          }
        })
        .catch(error => {
          console.error('로그인 상태 확인 중 오류 발생:', error);
        });

      // 문장 퀴즈 버튼 클릭 시 데이터 가져오기
      document.getElementById('sentence-quiz-button').addEventListener('click', () => {
        fetch('/get-sentence-quizzes')
          .then(response => response.json())
          .then(data => {
            quizzes = data;
            displayQuizzes(quizzes);
          })
          .catch(error => {
            console.error('퀴즈 목록을 불러오는 중 오류 발생:', error);
          });
      });

      // 그림 퀴즈 버튼 클릭 시 목록 비우기
      document.getElementById('image-quiz-button').addEventListener('click', () => {
        clearQuizList();
      });

      // 사운드 퀴즈 버튼 클릭 시 목록 비우기
      document.getElementById('sound-quiz-button').addEventListener('click', () => {
        clearQuizList();
      });

      // 검색 입력 이벤트 처리
      document.getElementById('search-input').addEventListener('input', (event) => {
        const searchText = event.target.value.toLowerCase();
        const filteredQuizzes = quizzes.filter(quiz =>
          quiz.title.toLowerCase().includes(searchText)
        );
        displayQuizzes(filteredQuizzes);
      });

      // 최대 버튼 클릭 시 문제 수 최대값 설정
      document.getElementById('set-max-questions').addEventListener('click', () => {
        const maxQuestions = document.getElementById('max-questions').textContent;
        document.getElementById('num-questions').value = maxQuestions;
      });
    });

    // 퀴즈 목록 표시
    function displayQuizzes(quizzes) {
      const quizListBody = document.getElementById('quiz-list').querySelector('tbody');
      quizListBody.innerHTML = '';
      quizzes.forEach(quiz => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td style="padding: 10px; text-align: center;">${quiz.title}</td>
          <td style="padding: 10px; text-align: center;">${quiz.username}</td>
          <td style="padding: 10px; text-align: center;">${quiz.created_at.split('T')[0]}</td>
        `;
        row.addEventListener('click', () => {
          document.getElementById('max-questions').textContent = quiz.question_count;
          document.getElementById('num-questions').max = quiz.question_count;
        });
        quizListBody.appendChild(row);
      });
    }

    // 퀴즈 목록 지우기
    function clearQuizList() {
      const quizListBody = document.getElementById('quiz-list').querySelector('tbody');
      quizListBody.innerHTML = '';
      document.getElementById('max-questions').textContent = '0';
      document.getElementById('num-questions').value = '1';
    }
  </script>
</body>

</html>